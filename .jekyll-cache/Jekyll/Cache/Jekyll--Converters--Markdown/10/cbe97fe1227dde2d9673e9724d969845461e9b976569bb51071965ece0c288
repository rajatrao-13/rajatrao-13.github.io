I"g"<h2 id="brief">Brief</h2>
<p>    On enumerating different services of <code class="highlighter-rouge">Monteverde</code> machine, we were able extract list of users available in the target machine. Due to security misconfiguration, one of the users has set the password same as the username and this was identified by brute forcing the same using <code class="highlighter-rouge">smb_login</code> module from <code class="highlighter-rouge">metasploit</code>. Levering the misconfiguration, we were able to login to <code class="highlighter-rouge">SMB</code> with the help of <code class="highlighter-rouge">smbclient</code> and on further enumeration, we were able to extract a file named <code class="highlighter-rouge">azure.xml</code> under <code class="highlighter-rouge">mhope</code> user folder consisting of credentails of the same user. Making the use of credential found, we were able to get <code class="highlighter-rouge">Windows Remote Management</code> shell with the help of tool named <code class="highlighter-rouge">evil-winrm</code> which targets on port <code class="highlighter-rouge">5985</code> port. Here, we were able to get basic shell and were able pwn the <code class="highlighter-rouge">user.txt</code> part of the challenge. Moving to privilege escalation part, enumemrating local system, we were able to understand the target machine has <code class="highlighter-rouge">Azure Active Directory Connect</code>. On searching for exploits on google, we were able to find a script and privilege to highest level of authorization and complete the final challenge of getting <code class="highlighter-rouge">root.txt</code></p>

<p> </p>

<h2 id="flow">Flow</h2>
<ul>
  <li>
    <p><code class="highlighter-rouge">enum4linux</code> reveals list of users name</p>
  </li>
  <li>
    <p>Brute Forcing <code class="highlighter-rouge">SMb</code> via <code class="highlighter-rouge">metasploit</code> using the usernames as password identifies a legit credential (<code class="highlighter-rouge">SABatchJobs:SABatchJobs</code>)</p>
  </li>
  <li>
    <p>Login as <code class="highlighter-rouge">SABatchJobs</code> in <code class="highlighter-rouge">SMB</code> via <code class="highlighter-rouge">smbcleint</code></p>
  </li>
  <li>
    <p>Enumerate <code class="highlighter-rouge">mhope</code> folder and download <code class="highlighter-rouge">azure.xml</code> which consists of mhope credentials (<code class="highlighter-rouge">mhope:4n0therD4y@n0th3r$</code>)</p>
  </li>
  <li>
    <p>Login as <code class="highlighter-rouge">mhope</code> in Win-RM Service (5985) using <code class="highlighter-rouge">evil-winrm</code></p>
  </li>
  <li>
    <p>Get <code class="highlighter-rouge">user.txt</code></p>
  </li>
  <li>
    <p>Local enumeramation discloses usage of <code class="highlighter-rouge">Azure AD Connect</code> in target machine</p>
  </li>
  <li>
    <p>Search for Azure AD exploit leads to powershell script (module) to generate new <code class="highlighter-rouge">administrator</code> password in the target machine</p>
  </li>
  <li>
    <p>Use newly generated <code class="highlighter-rouge">administrator</code> credentials and login as <code class="highlighter-rouge">administrator</code> in <code class="highlighter-rouge">Win-RM service</code> (5985) using <code class="highlighter-rouge">evil-winrm</code></p>
  </li>
  <li>
    <p>Get <code class="highlighter-rouge">root.txt</code></p>
  </li>
</ul>

<p> </p>

<p>Below is a detail writeup of the machine following the below steps:</p>

<ol>
  <li>
    <p><a href="http://localhost:4000/hackthebox/2020/06/05/HackTheBox-Monteverde/#informationgathering">Information Gathering</a></p>
  </li>
  <li>
    <p><a href="http://localhost:4000/hackthebox/2020/06/05/HackTheBox-Monteverde/#lowprivilegeshell">Low-Privilege Shell</a></p>
  </li>
  <li>
    <p><a href="http://localhost:4000/hackthebox/2020/06/05/HackTheBox-Monteverde/#privilegeescaltion">Privilege Escalation</a></p>
  </li>
</ol>

<p> </p>

<h2 id="1-information-gathering">1. Information Gathering</h2>

<h3 id="11--nmap">1.1 || Nmap</h3>
<p>$ nmap -sC -sV -p- -oA full 10.10.10.172</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Nmap 7.80 scan initiated Tue May 26 14:02:41 2020 as: nmap -sC -sV -p- -oA full -Pn 10.10.10.172</span>
<span class="s">Nmap scan report for 10.10.10.172</span>
<span class="s">Host is up (0.13s latency).</span>
<span class="na">Not shown</span><span class="pi">:</span> <span class="s">65516 filtered ports</span>
<span class="s">PORT      STATE SERVICE       VERSION</span>
<span class="s">53/tcp    open  domain?</span>
<span class="pi">|</span> <span class="err">fingerprint-strings:</span> 
<span class="err">|</span><span class="s">   DNSVersionBindReqTCP: </span>
<span class="err">|</span><span class="s">     version</span>
<span class="err">|</span><span class="s">_    bind</span>
<span class="err">8</span><span class="s">8/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2020-05-26 07:53:02Z)</span>
<span class="err">1</span><span class="s">35/tcp   open  msrpc         Microsoft Windows RPC</span>
<span class="err">1</span><span class="s">39/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span>
<span class="err">3</span><span class="s">89/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)</span>
<span class="err">4</span><span class="s">45/tcp   open  microsoft-ds?</span>
<span class="err">4</span><span class="s">64/tcp   open  kpasswd5?</span>
<span class="err">5</span><span class="s">93/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span class="err">6</span><span class="s">36/tcp   open  tcpwrapped</span>
<span class="err">3</span><span class="s">268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)</span>
<span class="err">3</span><span class="s">269/tcp  open  tcpwrapped</span>
<span class="err">5</span><span class="s">985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span>
<span class="err">|</span><span class="s">_http-server-header: Microsoft-HTTPAPI/2.0</span>
<span class="err">|</span><span class="s">_http-title: Not Found</span>
<span class="err">9</span><span class="s">389/tcp  open  mc-nmf        .NET Message Framing</span>
<span class="err">4</span><span class="s">9667/tcp open  msrpc         Microsoft Windows RPC</span>
<span class="err">4</span><span class="s">9673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span class="err">4</span><span class="s">9674/tcp open  msrpc         Microsoft Windows RPC</span>
<span class="err">4</span><span class="s">9675/tcp open  msrpc         Microsoft Windows RPC</span>
<span class="err">4</span><span class="s">9706/tcp open  msrpc         Microsoft Windows RPC</span>
<span class="err">4</span><span class="s">9778/tcp open  msrpc         Microsoft Windows RPC</span>
<span class="err">1</span><span class="s"> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span>
<span class="err">S</span><span class="s">F-Port53-TCP:V=7.80%I=7%D=5/26%Time=5ECCD5D6%P=x86_64-pc-linux-gnu%r(DNSV</span>
<span class="err">S</span><span class="s">F:ersionBindReqTCP,20,"\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\</span>
<span class="err">S</span><span class="s">F:x04bind\0\0\x10\0\x03");</span>
<span class="err">S</span><span class="s">ervice Info: Host: MONTEVERDE; OS: Windows; CPE: cpe:/o:microsoft:windows</span>

<span class="err">H</span><span class="s">ost script results:</span>
<span class="err">|</span><span class="s">_clock-skew: -46m43s</span>
<span class="err">|</span><span class="s"> smb2-security-mode: </span>
<span class="err">|</span><span class="s">   2.02: </span>
<span class="err">|</span><span class="s">_    Message signing enabled and required</span>
<span class="err">|</span><span class="s"> smb2-time: </span>
<span class="err">|</span><span class="s">   date: 2020-05-26T07:55:26</span>
<span class="err">|</span><span class="s">_  start_date: N/A</span>

<span class="err">S</span><span class="s">ervice detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span>
<span class="err">#</span><span class="s"> Nmap done at Tue May 26 14:14:49 2020 -- 1 IP address (1 host up) scanned in 728.28 seconds</span>

</code></pre></div></div>
<p>where,</p>

<p>    -sC : Run Default Scripts</p>

<p>    -sV : Enumerate different versions</p>

<p>    -sC : Store the output in all format (.nmap, .xml and .gnmap) having name full</p>
:ET